<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hybrid AI Agent — Real UI</title>
<style>
  :root{
    --bg-0:#0c1220;
    --sidebar-bg:#111218;
    --panel-bg: linear-gradient(180deg, rgba(18,24,35,0.95), rgba(12,16,24,0.85));
    --muted:#9aa3b2;
    --text:#e8eef9;
    --accent:#10a37f;
    --glass: rgba(255,255,255,0.03);
    --card:#0f1720;
    --card-border: rgba(130,150,220,0.06);
    --glass-strong: rgba(255,255,255,0.06);
    --success: #23c58a;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", system-ui, -apple-system, Roboto, "Helvetica Neue", Arial;color:var(--text);background:
    radial-gradient(circle at 10% 10%, rgba(13,20,48,0.55), transparent 30%),
    linear-gradient(180deg,#071027 0%, #020412 100%);}

  /* layout */
  .app {
    height:100vh;
    display:flex;
    gap:18px;
    padding:18px;
    align-items:stretch;
  }

  /* --- sidebar --- */
  .sidebar {
    width:280px;
    background: linear-gradient(180deg, rgba(12,16,28,0.9), rgba(10,12,20,0.9));
    border-radius:12px;
    padding:18px;
    border:1px solid var(--card-border);
    box-shadow:0 8px 34px rgba(2,6,20,0.6);
    display:flex;
    flex-direction:column;
    gap:14px;
    flex-shrink:0;
  }
  .brand {
    display:flex;gap:10px;align-items:center;
  }
  .brand .logo {
    width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#6fbfda);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021218;
    box-shadow:0 6px 20px rgba(16,163,127,0.12);
  }
  .brand h2{font-size:16px;margin:0;color:var(--accent)}
  .brand p{margin:0;font-size:13px;color:var(--muted)}

  .sidebar-section {margin-top:6px}
  .sidebar-section h3{font-size:13px;color:var(--muted);margin:6px 0 8px 0}
  .nav-item {
    display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;cursor:pointer;
    background:transparent;border:1px solid transparent;
    transition: all .18s ease;
    color:var(--text);
  }
  .nav-item:hover{transform:translateX(4px);background:rgba(255,255,255,0.02);border-color:var(--card-border)}
  .nav-item.active{background:linear-gradient(90deg, rgba(16,163,127,0.08), rgba(111,160,255,0.02));border-color: rgba(110,140,255,0.12);box-shadow:0 6px 18px rgba(16,163,127,0.06)}

  .accordion {margin-top:8px}
  .accordion .title{display:flex;justify-content:space-between;align-items:center;padding:8px 6px;border-radius:8px;cursor:pointer}
  .accordion .content{overflow:hidden;max-height:0;transition:max-height .28s ease;padding-left:8px}
  .accordion .content.open{max-height:300px}
  .small{font-size:13px;color:var(--muted)}

  .sidebar-footer{margin-top:auto;font-size:12px;color:var(--muted);padding-top:8px;border-top:1px solid rgba(255,255,255,0.02)}

  /* --- main area --- */
  .main {
    flex:1;display:flex;flex-direction:column;gap:16px;height:100%;
  }
  .topbar {
    height:64px;background:var(--panel-bg);border-radius:12px;padding:12px 18px;display:flex;align-items:center;justify-content:space-between;border:1px solid var(--card-border);
  }
  .topbar .title {font-weight:700;color:var(--accent);display:flex;gap:12px;align-items:center}
  .topbar .actions {display:flex;gap:10px;align-items:center}

  /* --- content area --- */
  .content {
    flex:1; display:flex; gap:16px; overflow:hidden;
  }

  /* left column = chat area */
  .chat-area {
    flex:1;display:flex;flex-direction:column;gap:12px;
    background: linear-gradient(180deg, rgba(8,12,20,0.6), rgba(6,8,14,0.6));
    border-radius:12px;padding:16px;border:1px solid var(--card-border); box-shadow: 0 10px 40px rgba(2,6,20,0.6); overflow:hidden;
  }

  .hero {
    text-align:center;padding:22px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    margin-bottom:6px;
  }
  .hero h1{margin:0;font-size:20px;color:var(--accent)}
  .hero p{color:var(--muted);margin-top:8px}

  .chat-window {flex:1; overflow:auto;padding:8px 6px;display:flex;flex-direction:column;gap:10px}
  /* message rows */
  .msg-row{display:flex;width:100%}
  .msg-row.user{justify-content:flex-end}
  .msg-row.ai{justify-content:flex-start}
  .msg {
    display:inline-block;padding:12px 14px;border-radius:12px;max-width:72%;line-height:1.35;font-size:14px;word-wrap:break-word;white-space:pre-wrap;
    box-shadow: 0 6px 18px rgba(2,6,20,0.4);
  }
  .msg.user {background:linear-gradient(180deg, rgba(53,99,255,0.95), rgba(61,93,213,0.95));color:white;border:1px solid rgba(255,255,255,0.02)}
  .msg.ai {background:linear-gradient(180deg, rgba(18,25,44,0.95), rgba(26,36,60,0.95)); color:#dce8ff; border:1px solid rgba(255,255,255,0.02)}
  .meta {font-size:11px;color:var(--muted);margin-top:6px}

  /* typing indicator */
  .typing {color:var(--accent);font-weight:600;font-size:13px;margin-left:6px;display:flex;align-items:center;gap:8px}
  .dot {width:8px;height:8px;border-radius:50%;background:var(--accent);opacity:0.9;animation:bounce 1.1s infinite}
  @keyframes bounce{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}

  /* input area */
  .composer {
    display:flex;gap:12px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));align-items:flex-end;
    border:1px solid var(--card-border);
  }
  .composer textarea{flex:1;border-radius:12px;padding:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);color:var(--text);resize:none;min-height:48px;max-height:220px;overflow:auto}
  .composer .send-btn{background:var(--accent);border:none;color:#021218;padding:10px 16px;border-radius:12px;font-weight:700;cursor:pointer}
  .composer .send-btn[disabled]{opacity:0.6;cursor:not-allowed}

  /* right column = tools/panels */
  .panel {
    width:360px;flex-shrink:0;background:linear-gradient(180deg, rgba(12,16,24,0.9), rgba(8,10,16,0.9));border-radius:12px;padding:14px;border:1px solid var(--card-border);overflow:auto;
  }
  .panel h3{margin:0 0 10px 0;color:var(--muted)}
  .card-grid{display:grid;grid-template-columns:1fr;gap:12px}
  .tool-card{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.02)}
  .tool-card h4{margin:0 0 6px 0;color:var(--text)}
  .tool-card p{margin:0;color:var(--muted);font-size:13px}
  .tool-card .actions{margin-top:10px;display:flex;gap:8px}

  .tool-btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;background:rgba(255,255,255,0.03);color:var(--text)}
  .tool-btn.primary{background:var(--accent);color:#021218;font-weight:700}

  /* modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:none;align-items:center;justify-content:center;z-index:9999}
  .modal{background:linear-gradient(180deg, rgba(18,24,34,0.98), rgba(12,18,26,0.98));padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);width:440px;max-width:90%}
  .modal h3{margin:0 0 12px;color:var(--accent)}
  .modal p{color:var(--muted);margin-bottom:12px}
  .modal .modal-actions{display:flex;gap:8px;justify-content:flex-end}

  /* logger (dev) */
  .logger {font-size:12px;color:var(--muted);margin-top:8px;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;max-height:110px;overflow:auto}

  /* responsive */
  @media(max-width:980px){
    .app{padding:12px}
    .sidebar{display:none}
    .panel{display:none}
  }
</style>
</head>
<body>

<div class="app" role="application">

  <!-- SIDEBAR -->
  <aside class="sidebar" role="navigation" aria-label="Main menu">
    <div class="brand">
      <div class="logo">AI</div>
      <div>
        <h2>Hybrid AI Agent</h2>
        <p class="small">Troubleshoot • Automate • Assist</p>
      </div>
    </div>

    <div class="sidebar-section" aria-hidden="false">
      <h3>Main</h3>
      <div class="nav-item active" data-view="chat" tabindex="0" onclick="showView('chat', this)">Chat</div>
      <div class="nav-item" data-view="scan" tabindex="0" onclick="showView('scan', this)">System Scan</div>
      <div class="nav-item" data-view="automation" tabindex="0" onclick="showView('automation', this)">Automation Tasks</div>
    </div>

    <div class="sidebar-section">
      <h3>Tools</h3>
      <div class="accordion">
        <div class="title" onclick="toggleAccordion(this)"><strong>File Tools</strong><span class="small">▸</span></div>
        <div class="content">
          <a href="#" onclick="openTool('rename')">Bulk Rename Files</a>
          <a href="#" onclick="openTool('organize')">Organize Photos</a>
        </div>
      </div>

      <div class="accordion">
        <div class="title" onclick="toggleAccordion(this)"><strong>Network</strong><span class="small">▸</span></div>
        <div class="content">
          <a href="#" onclick="openTool('ping')">Ping Test</a>
          <a href="#" onclick="openTool('speed')">Speed Test (demo)</a>
        </div>
      </div>
    </div>

    <div class="sidebar-footer">
      <div class="small">Trusted stack: <strong style="color:var(--accent)">FastAPI</strong>, <strong style="color:#6792ff">Flowise</strong>, LLM</div>
      <div class="small" style="margin-top:8px">Demo-ready • Backend integration hooks included</div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main" role="main">
    <div class="topbar" role="region" aria-label="Top bar">
      <div class="title"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.95"><path d="M12 3v18M3 12h18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg> System Helper</div>
      <div class="actions">
        <button class="tool-btn" onclick="toggleLogger()">Toggle Log</button>
      </div>
    </div>

    <div class="content">

      <!-- CHAT AREA -->
      <section class="chat-area" aria-live="polite">
        <div class="hero">
          <h1>Diagnose, Automate, Resolve</h1>
          <p>Ask the agent about system issues or choose an automation. The agent will confirm destructive actions before running them.</p>
        </div>

        <div id="chatWindow" class="chat-window" role="log" aria-atomic="false">
          <!-- example messages -->
          <div class="msg-row ai">
            <div class="msg ai">
              Welcome — I'm your hybrid AI troubleshooter. Tell me the issue or choose a tool on the right.
              <div class="meta">agent • just now</div>
            </div>
          </div>
        </div>

        <!-- composer -->
        <div class="composer" role="textbox" aria-label="Message composer">
          <textarea id="composer" placeholder="Describe the issue or type a command (Shift+Enter = newline)"></textarea>
          <button id="sendBtn" class="send-btn">Send</button>
        </div>

        <div id="logger" class="logger" style="display:none"></div>
      </section>

      <!-- RIGHT PANEL (TOOLS) -->
      <aside class="panel" aria-label="Tools and Automations">
        <h3 id="panelTitle">Quick Tools</h3>

        <div id="panelContent" class="card-grid">
          <div class="tool-card" id="card-scan">
            <h4>System Scan</h4>
            <p>Run a safety-first quick scan of CPU, RAM and Disk (demo mode).</p>
            <div class="actions">
              <button class="tool-btn primary" onclick="runSystemScan()">Run Scan</button>
              <button class="tool-btn" onclick="showInfo('scan')">Details</button>
            </div>
          </div>

          <div class="tool-card" id="card-clean">
            <h4>Disk Cleanup</h4>
            <p>Clean temporary files (will ask for confirmation before any deletion).</p>
            <div class="actions">
              <button class="tool-btn primary" onclick="prepareAutomation('clean-temp')">Prepare Cleanup</button>
              <button class="tool-btn" onclick="showInfo('clean')">Details</button>
            </div>
          </div>

          <div class="tool-card" id="card-rename">
            <h4>Bulk Rename</h4>
            <p>Generate a safe PowerShell / Batch script to rename files in a folder.</p>
            <div class="actions">
              <button class="tool-btn primary" onclick="generateScript('bulk-rename')">Generate Script</button>
              <button class="tool-btn" onclick="showInfo('rename')">Preview</button>
            </div>
          </div>
        </div>

        <div style="margin-top:14px" id="panelFooter">
          <small class="small">All actions require explicit user confirmation before execution. Backend integration will use authenticated API to run tools.</small>
        </div>
      </aside>

    </div> <!-- end content -->
  </main>

</div> <!-- end app -->

<!-- modal -->
<div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true">
  <div class="modal" role="document" aria-labelledby="modalTitle">
    <h3 id="modalTitle">Confirm Action</h3>
    <p id="modalBody">Are you sure?</p>
    <div class="modal-actions">
      <button class="tool-btn" onclick="closeModal()">Cancel</button>
      <button class="tool-btn primary" id="modalConfirmBtn">Confirm</button>
    </div>
  </div>
</div>

<script>
/* ---------- Utilities ---------- */
const state = {
  view: 'chat',
  log: [],
  backendUrl: 'http://localhost:8000', // update when backend ready
};

/* simple logger */
function log(...args){
  const line = `[${new Date().toLocaleTimeString()}] ` + args.join(' ');
  state.log.push(line);
  const el = document.getElementById('logger');
  if(el) { el.innerText = state.log.slice(-200).join('\\n'); }
  console.debug(...args);
}

/* ---------- Sidebar / Panels ---------- */
function showView(view, el){
  state.view = view;
  // active nav-item
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  if(el && el.classList) el.classList.add('active');
  // show different content in the right panel (simple)
  const panelTitle = document.getElementById('panelTitle');
  const panelContent = document.getElementById('panelContent');
  panelContent.innerHTML = ''; // clear, then render
  if(view==='chat'){
    panelTitle.innerText = 'Quick Tools';
    panelContent.appendChild(document.getElementById('card-scan').cloneNode(true));
    panelContent.appendChild(document.getElementById('card-clean').cloneNode(true));
    panelContent.appendChild(document.getElementById('card-rename').cloneNode(true));
  } else if(view==='scan'){
    panelTitle.innerText = 'System Scan';
    panelContent.innerHTML = `
      <div class="tool-card"><h4>Quick Scan</h4><p>CPU, RAM, Disk snapshot</p><div class="actions"><button class="tool-btn primary" onclick="runSystemScan()">Run Scan</button></div></div>
      <div class="tool-card"><h4>Detailed Scan</h4><p>Collect logs & processes (requires backend)</p><div class="actions"><button class="tool-btn" onclick="showInfo('dscan')">Info</button></div></div>
    `;
  } else if(view==='automation'){
    panelTitle.innerText = 'Automation Tasks';
    panelContent.innerHTML = `
      <div class="tool-card"><h4>Bulk Rename</h4><p>Generate & download scripts</p><div class="actions"><button class="tool-btn primary" onclick="generateScript('bulk-rename')">Generate</button></div></div>
      <div class="tool-card"><h4>Organize Photos</h4><p>Script generator</p><div class="actions"><button class="tool-btn" onclick="generateScript('organize-photos')">Generate</button></div></div>
    `;
  }
  log('Switched view to', view);
}

/* accordion toggle */
function toggleAccordion(el){
  const content = el.nextElementSibling;
  const caret = el.querySelector('.small');
  if(content.classList.contains('open')) { content.classList.remove('open'); caret.innerText='▸'; }
  else { content.classList.add('open'); caret.innerText='▾'; }
}

/* open specific tool quick */
function openTool(key){
  showView('automation');
  setTimeout(()=> {
    // focus or show relevant card (simple highlight)
    const cards = document.querySelectorAll('#panelContent .tool-card');
    cards.forEach(c=>c.style.boxShadow='none');
  }, 250);
  log('Open tool:', key);
}

/* ---------- Chat / Composer ---------- */
const chatWindow = document.getElementById('chatWindow');
const composer = document.getElementById('composer');
const sendBtn = document.getElementById('sendBtn');

function appendMessage(who, text, meta){
  const row = document.createElement('div');
  row.className = 'msg-row ' + (who==='user' ? 'user' : 'ai');
  const bubble = document.createElement('div');
  bubble.className = 'msg ' + (who==='user' ? 'user' : 'ai');
  bubble.innerText = text;
  // meta timestamp
  const metaEl = document.createElement('div');
  metaEl.className = 'meta';
  metaEl.innerText = (meta || new Date().toLocaleTimeString());
  bubble.appendChild(metaEl);
  row.appendChild(bubble);
  chatWindow.appendChild(row);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

/* typing indicator: show a special bubble */
function showTyping(on=true){
  if(on){
    const row = document.createElement('div');
    row.className = 'msg-row ai typing-row';
    row.id = 'typingRow';
    const bubble = document.createElement('div');
    bubble.className = 'msg ai';
    bubble.innerHTML = '<div style="display:flex;align-items:center;gap:8px"><div class="dot"></div><div>Thinking...</div></div>';
    row.appendChild(bubble);
    chatWindow.appendChild(row);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  } else {
    const r = document.getElementById('typingRow');
    if(r) r.remove();
  }
}

/* send message -> either call backend or simulate */
async function sendMessage(){
  const text = composer.value.trim();
  if(!text) return;
  appendMessage('user', text);
  composer.value = '';
  composer.style.height = ''; // reset auto-height
  showTyping(true);

  // we will call backend here; for now simulate delay and response
  try {
    const response = await sendToBackend(text); // placeholder for real call
    showTyping(false);
    appendMessage('ai', response);
  } catch(err){
    showTyping(false);
    appendMessage('ai', 'Error: could not reach backend. (Demo fallback)\\n' + err.message);
    log('sendMessage error', err);
  }
}

/* sendToBackend: placeholder for Flowise/FastAPI integration
   Replace this with a real fetch to your Python backend:
   POST ${state.backendUrl}/chat { "message": text, ... } */
async function sendToBackend(text){
  log('Sending to backend:', text);
  // Simulate network time + basic parsing
  await new Promise(r => setTimeout(r, 800));
  // Simple demo rules: detect keywords to demonstrate hybrid
  if(/rename|script|rename files|bulk rename/i.test(text)){
    return 'I can generate a bulk-rename script for you. Do you want PowerShell or Batch?';
  }
  if(/slow|network|internet|ping/i.test(text)){
    return 'I detected a network issue pattern. I recommend running a ping and checking DNS. Shall I run a quick ping test?';
  }
  // fallback generic
  return 'Demo agent reply: ' + text + ' \\n(When backend is connected, Flowise will generate a full answer.)';
}

/* Enter behavior: Enter sends, Shift+Enter newline */
composer.addEventListener('keydown', (e)=>{
  if(e.key==='Enter' && !e.shiftKey){
    e.preventDefault();
    sendMessage();
  }
});

/* auto-resize textarea */
composer.addEventListener('input', () => {
  composer.style.height = 'auto';
  composer.style.height = (composer.scrollHeight) + 'px';
});

/* Send button */
sendBtn.addEventListener('click', sendMessage);

/* ---------- Tools & Automation: demo actions ---------- */

/* Run system scan (demo) */
async function runSystemScan(){
  // simulate scan and show results in chat
  appendMessage('user', 'Please run a quick system scan (demo).');
  showTyping(true);
  log('Running system scan (demo)');
  await new Promise(r=>setTimeout(r,1200));
  showTyping(false);
  appendMessage('ai', 'Quick Scan Results:\\n• CPU: 22%\\n• RAM: 46%\\n• Disk free: 120 GB (40%)\\nNo critical issues found.');
}

/* Prepare cleanup: ask to confirm path & action */
function prepareAutomation(action){
  if(action==='clean-temp'){
    openModal({
      title: 'Confirm Disk Cleanup',
      body: 'This will delete files from TEMP directories. Are you sure you want to proceed? (Demo mode: nothing will be deleted.)',
      onConfirm: async ()=>{
        closeModal();
        appendMessage('user', 'Confirm: run disk cleanup (demo).');
        showTyping(true);
        log('User confirmed cleanup');
        await new Promise(r=>setTimeout(r,1000));
        showTyping(false);
        appendMessage('ai', 'Cleanup simulated: Removed 237 MB of temporary files. (Demo)');
      }
    });
  }
}

/* Generate script & download demo file */
function generateScript(kind){
  let filename='script.ps1', content='';
  if(kind==='bulk-rename'){
    filename='bulk-rename-demo.ps1';
    content = `# Bulk rename demo (PowerShell)\\n$files = Get-ChildItem -Path . -Filter "*.txt"\\n$i=1\\nforeach($f in $files){ Rename-Item $f.FullName -NewName ("file_{0}.txt" -f $i); $i++ }\\nWrite-Host "Done (demo)";`;
  } else if(kind==='organize-photos'){
    filename='organize-photos-demo.ps1';
    content = `# Organize photos demo\\nGet-ChildItem -Path . -Include *.jpg,*.png -Recurse | ForEach-Object { $y=(Get-Date $_.CreationTime).Year; $dest=Join-Path -Path . -ChildPath $y; if(!(Test-Path $dest)){New-Item -ItemType Directory -Path $dest}; Move-Item -Path $_.FullName -Destination $dest }\\nWrite-Host 'Done (demo)';`;
  } else {
    filename='script-demo.ps1';
    content = '# Demo script';
  }
  downloadFile(filename, content);
  appendMessage('ai', `Generated script '${filename}'. Downloaded to your browser (demo).`);
  log('Generated script', filename);
}

/* simple download helper */
function downloadFile(name, text){
  const a = document.createElement('a');
  const blob = new Blob([text], {type:'text/plain'});
  a.href = URL.createObjectURL(blob);
  a.download = name;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(a.href);
}

/* preview info */
function showInfo(key){
  openModal({title:'Tool Info', body: `This is demo info for tool: ${key}. In production, this will call backend to run safe actions.`});
}

/* ---------- modal helpers ---------- */
function openModal({title='Confirm', body='Are you sure?', onConfirm=null}){
  const backdrop = document.getElementById('modalBackdrop');
  backdrop.style.display='flex';
  document.getElementById('modalTitle').innerText = title;
  document.getElementById('modalBody').innerText = body;
  const btn = document.getElementById('modalConfirmBtn');
  // remove previous handlers
  const newBtn = btn.cloneNode(true);
  btn.parentNode.replaceChild(newBtn, btn);
  newBtn.addEventListener('click', ()=> {
    if(onConfirm) onConfirm();
  });
}
function closeModal(){ document.getElementById('modalBackdrop').style.display='none'; }

/* ---------- logger toggle ---------- */
function toggleLogger(){
  const el = document.getElementById('logger');
  el.style.display = (el.style.display==='none' || el.style.display==='') ? 'block' : 'none';
}

/* ---------- dev: initial view populate ---------- */
showView('chat', document.querySelector('.nav-item.active'));

/* expose hooks for backend later */
window._hybridAgent = {
  sendToBackend,
  appendMessage,
  generateScript,
  runSystemScan,
  prepareAutomation,
  log
};

</script>
</body>
</html>
